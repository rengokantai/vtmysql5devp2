# vtmysql5devp2


## Configuration
### Startup Options
```
mysqld --verbose --help
```
### Configuration File

### Important Configuration Options

## Manipulating data
### Data Manipulation Basics
Data Manipulatoin Language(DML)
### warnings and Errors
What's the Difference
- Warning tells us something bad happened, but the system allowed it anyway
- Error tells us something bsd would have happened, but the system prevented it
- Giving warnings is the MySQL default.
- ```sql_mode``` variable lets us override default  


Warnings
- Multiple warnings can be generated by a single command
- Intended to not halt the execution of a script
- Execution of new command clears previous warning messages
- Bad for data integrity when encountered
- Same codes and text as errors

Errprs
- Usually only one error will be reported by a command
- Because execution is halted with no action taken when error is encountered
- Intended to protected data integrity
- Execution of new command clears previous error messages
### SQL Modes
Two kinds of SQL Mode
- Affects the way certain ssyntax elements are interpreted (not a good idea)
- Elevates warnings to errors(important)


### Changing Syntax Interpretationura
```
set sql_mode=ansi_quotes(not allow double quote as column name) ,pipes_as_concat,....
```
[see here to check sql_mode](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=0ahUKEwiLm8KBvcjLAhWqlIMKHVlnDjsQFggdMAA&url=http%3A%2F%2Fdev.mysql.com%2Fdoc%2Fen%2Fsql-mode.html&usg=AFQjCNH9tpAIuRZz737R7FV0xrh7Wd4j0g&sig2=kaywR6VXnuaevNuiuN4K5Q)

restore:
```
set sql_mode='';
```
### Elevating Warnings to Errors
```
mysql -u root --show-warnings
```
Or: (tinyint only support 2-digit number)
```
insert into tbname values(1),(12),(123);
show warnings\G
```
```
set sql_mode=traditional  //warning=error!
```
### Interpreting Error Messages
error code:  
server error: <2000  
client error >=2000  
### Note Warnings
```
set sql_notes = 0
```
note warnings will no longer be returned.
### System Error Warnings
(HY000) file system error code
````
select * from tbname into outfile 'c:/txt';
```

get error code
```
perror (0,1,2,...)
```
Or (must in unix)
```
mysql> system perror 2  (or  \! perror 2)
```

## Inserting Data
### INSERT Demonstrations
ternary operator, and get date of 25 years ago.
```
CONCAT('San' , IF(MOD(DAY(CURDATE()),2),'Joe','Meo')),CURDATE()-INTERVAL 25 YEAR
```












#####importing data
#######importing datac(by default, tab seperated)
much faster than inserts.  
```
LOAD DATA INFILE 'file.txt' into table tbname;
```
\N : null (If we want to change delimiter files,  like \N = @N) add
```
escaped by '@'
```
######importing nontab
```
LOAD DATA INFILE 'file.txt' into table tbname fields terminated by ',' enclosed by '"' lines terminated by '\r';
```
######skipping header lines
```
LOAD DATA INFILE 'file.txt' into table tbname ignore 1 lines;
```
######change import column order
```
LOAD DATA INFILE 'file.txt' into table tbname(clname2,clname1,clname3);
LOAD DATA INFILE 'file.txt' into table tbname(@skip,clname1,clname3);  //skip somw column
```
###### convert data on import
















#####Trigger
######use of trigger.
for data validation:  
######syntax
timing: before, after  
op: insert update delete

######exam
```sql
create trigger trigname before insert on tbname
for each row
set new.cls2 = month(new.cls3)
```

delete table1 and copy to table2:
```sql
create trigger tgname after delete on table1
for each row
insert into table2 values(OLD.clname1,OLD.clname2);
```

######explor
```
show create trigger tgname\G
```

######trigger metadata
```
show triggers where `Trigger` = 'tgname'\G
desc information_schema.triggers;
```
###### drop trigger

trn (per trigger) and trg (per table) file  
trn file is short(placeholder), trg file is long  

trigger name may diff in database, not table!
```
drop triggger tgname;
```

######limitations
cannot return a result set to client.  
cannot manipulate rows in table used by statement that launched it.  
changes to columns in current row must be performed in a BEFORE trigger





#####event
######event basic
store in mysql.event table.
######event execution
```
set global event_scheduler = ON
```
examine last_executed column for event in information_schema.events table
######event syntax
######schedule type
at < timestamp>, or immediate  
recurring events:
every <intervel> starts <exp> ends <exp>


######event metadata
```
show create event evtname\G
```
```
show events
```








#####indexes
######Index basics
index is a seperate table maintains row order for a column or comb of columns of a table  
issues: slows data manipulation operation because it is dynamically maintained(addition storage)

######defining indexes for table
```
show index from tbname\G
```


###### add indexes
```
alter table tbname add primary key(clname)
alter table tbname add index(clname)
alter table tbname add index idxname (clname)
create index idxname on tbname(clname)
drop index idxname on tbname
```
###### dropping indexes
```
drop index idxname on tbname
alter table tbname drop index a, drop index b
```
######compound indexes
```sql
create table tbname(
firstname varchar(10),
lstaname varchar(20),
.....,
index fullname(firstname,lastname)
);
```
######prefix

only index first n chars.
```sql
create table country(
name char(200),
...,
index (name(10))
```

note sub_part

######fulltext index
```sql
create table tbname(
clname varchar(100),
FULLTEXT KEY keyname(clname)
)
```

```
select * from tbname where match (clname) against ('keywordxxxx');
```

search  text contains keyword1 OR keyword2
```
select * from tbname where match (clname) against ('keyword1 keyword2');
```
score means how similiar
```
select match(clname) against ('a b') Score , clname from tbname where match(clname) against('a b');
```

add + sign means mandatory  (keyword1 is mandatory)
```
select * from tbname where match (clname) against ('+keyword1 keyword2' IN BOOLEAN MODE);
```

add - sign means sentence with k2 can not have k1.
```
select * from tbname where match (clname) against ('-keyword1 keyword2' IN BOOLEAN MODE);
```
ywith query expansion
```
select * from tbname where match (clname) against ('keyword2' WITH QUERY EXPANSION);
```


#####efficiency check
######
procedure analyse keyword: s,not z
```
select * from yd procedure analyse()\G
```
######explain
indexed column vs non-indexed column:  
```
explain select * from test;
```
note the following : type (const vs all), row(1 vs 100000..), key(primary vs null)
